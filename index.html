<script>
    function updateQuestion() {
        questionElement.innerHTML = `Resuelve:`;
        operationElement.innerHTML = currentProblem.traditional;
        clearTimeout(timeOut);

        const remainingStepsPlayer1 = goalPosition - player1Position;
        const baseSpeed = 5000;
        const minSpeed = 1000;
        const speedMultiplier = 200;

        // Ajuste dinámico de la velocidad de player2
        const adjustedDelay = Math.max(
            minSpeed,
            baseSpeed - remainingStepsPlayer1 * speedMultiplier
        );

        // Movimiento continuo de player2
        timeOut = setTimeout(() => {
            if (player2Position < goalPosition) {
                player2Position++;
                movePlayer(player2, player2Position);
                if (player2Position === goalPosition) {
                    declareWinner("La computadora ha ganado la carrera. Intenta de nuevo.");
                } else {
                    updateQuestion(); // Llamada recursiva para seguir moviendo player2
                }
            }
        }, adjustedDelay);
    }

    function checkAnswer() {
        const playerAnswer = parseFloat(answerInput.value);

        if (isNaN(playerAnswer)) {
            feedbackElement.textContent = "Por favor, ingresa un número válido.";
            return;
        }

        if (playerAnswer === currentProblem.answer) {
            player1Position++;
            movePlayer(player1, player1Position);
            feedbackElement.textContent = "¡Correcto!";
            if (player1Position === goalPosition) {
                declareWinner("¡Felicidades! Has ganado la carrera.");
                return;
            }

            currentProblem = generateProblem();
            updateQuestion();
        } else {
            feedbackElement.textContent = "Respuesta incorrecta.";
            if (player2Position < goalPosition) {
                player2Position++;
                movePlayer(player2, player2Position);
                if (player2Position === goalPosition) {
                    declareWinner("La computadora ha ganado la carrera. Intenta de nuevo.");
                }
            }
        }

        answerInput.value = "";
    }

    function restartGame() {
        player1Position = 0;
        player2Position = 0;
        currentProblem = generateProblem();
        winnerElement.textContent = "";
        feedbackElement.textContent = "";
        answerInput.value = "";
        movePlayer(player1, player1Position);
        movePlayer(player2, player2Position);
        updateQuestion();
    }
</script>
